# 上交所公告爬虫工具

## 概述

本项目是一个使用 Python 编写的命令行工具，用于爬取和下载上海证券交易所（SSE）网站上的上市公司公告。

它通过模拟浏览器行为来获取合法的会话凭证，从而绕过网站的反爬虫机制，实现稳定、可靠的数据获取和文件下载。

## 功能特性

- **参数化查询**: 支持通过命令行参数指定证券代码、公告的起始日期和结束日期。
- **自动分页**: 能够自动处理API的分页逻辑，获取指定时间范围内的全部公告列表。
- **智能时间切分**: 当查询的时间跨度超过接口限制（如3年）时，工具会自动按自然年将任务切分为多个子任务，确保请求成功。
- **高级反爬虫策略**: 采用 Selenium 驱动真实浏览器与 `requests` 库相结合的混合策略，有效应对动态Cookie和浏览器环境检测等反爬措施。
- **灵活的输出管理**:
    - 支持通过参数自定义下载文件夹的名称。
    - 若未指定，则默认使用“证券代码_运行时间戳”的格式创建文件夹，便于归档。

## 环境要求

- Python 3.x
- Google Chrome 浏览器

## 安装

1.  克隆或下载本项目到本地。

2.  进入 `sse-announcements-scraper` 目录，通过 `pip` 安装所需的依赖库：
    ```bash
    pip install -r requirements.txt
    ```

## 使用方法

在终端中，确保**位于`sse-announcements-scraper`目录的上一级目录**，然后执行 `ann.py` 脚本。

### 1. 使用默认参数运行

查询默认股票（600036），时间范围为最近三年：
```bash
python3 sse-announcements-scraper/ann.py
```

### 2. 指定查询目标

查询贵州茅台（600519）在2013年至2023全年的公告：
```bash
python3 sse-announcements-scraper/ann.py 600519 --start 2013-01-01 --end 2023-12-31
```

### 3. 按关键字筛选公告

查询贵州茅台（600519），在最近三年内标题包含“股东大会”的公告：
```bash
python3 sse-announcements-scraper/ann.py 600519 --title 股东大会
```

### 4. 自定义输出文件夹

查询默认股票，并将结果保存在 `downloads/招商银行_2024半年报` 文件夹中：
```bash
python3 sse-announcements-scraper/ann.py 600036 --start 2024-01-01 --end 2024-08-26 --output 招商银行_2024半年报
```

### 参数说明

- `security_code`：证券代码（必填，但有默认值）。
- `--start`: 开始日期，格式 `YYYY-MM-DD`（可选，默认为三年前的今天）。
- `--end`: 结束日期，格式 `YYYY-MM-DD`（可选，默认为今天）。
- `--output`: 输出文件夹名称（可选，默认为 `[证券代码]_[时间戳]`）。
- `--title`: 按公告标题中的关键字进行筛选（可选）。
